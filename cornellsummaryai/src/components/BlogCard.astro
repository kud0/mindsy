---
import HeroImage from "./HeroImage.astro";

export interface Props {
  slug: string;
  title: string;
  description: string;
  heroImage?: string;
  pubDate: Date;
  author?: string;
  tags?: string[];
  draft?: boolean;
}

const { slug, title, description, heroImage, pubDate, author, tags, draft } = Astro.props;

// Format date helper function
function formatDate(date: Date): string {
  return date.toLocaleDateString("en-US", {
    year: "numeric",
    month: "short",
    day: "numeric",
  });
}
---

<article class="group relative bg-white rounded-xl overflow-hidden shadow-sm hover:shadow-xl transition-all duration-500 transform hover:-translate-y-1">
  <!-- Image Container with 16:9 aspect ratio -->
  <a href={`/blog/${slug}`} class="block aspect-[16/9] overflow-hidden bg-gradient-to-br from-blue-50 to-indigo-50">
    {heroImage ? (
      <HeroImage 
        src={heroImage} 
        alt={`${title} thumbnail`}
        class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700 ease-out"
        loading="lazy"
        showFallback={false}
      />
    ) : (
      <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-50">
        <svg class="w-16 h-16 text-blue-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" 
            d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />
        </svg>
      </div>
    )}
  </a>

  <!-- Content Container -->
  <div class="p-6">
    <!-- Draft Badge -->
    {draft && !import.meta.env.PROD && (
      <span class="absolute top-4 right-4 z-10 bg-yellow-400 text-yellow-900 text-xs font-semibold px-2 py-1 rounded-full">
        DRAFT
      </span>
    )}

    <!-- Meta Information -->
    <div class="flex items-center gap-3 text-sm text-gray-500 mb-3">
      <time datetime={pubDate.toISOString()} class="font-medium">
        {formatDate(pubDate)}
      </time>
      {author && (
        <>
          <span class="w-1 h-1 bg-gray-400 rounded-full"></span>
          <span>{author}</span>
        </>
      )}
    </div>

    <!-- Title -->
    <h3 class="text-xl font-bold text-gray-900 mb-2 line-clamp-2 group-hover:text-blue-600 transition-colors duration-300">
      <a href={`/blog/${slug}`} class="hover:underline decoration-2 underline-offset-2">
        {title}
      </a>
    </h3>

    <!-- Description -->
    <p class="text-gray-500 text-sm italic line-clamp-3 mb-4 leading-relaxed opacity-80">
      {description}
    </p>

    <!-- Tags -->
    {tags && tags.length > 0 && (
      <div class="flex flex-wrap gap-2 mb-4">
        {tags.slice(0, 3).map((tag) => (
          <a 
            href={`/blog/tags/${tag}`}
            class="text-xs px-2.5 py-1 rounded-full bg-gray-100 text-gray-600 hover:bg-blue-100 hover:text-blue-700 transition-colors duration-200"
          >
            #{tag}
          </a>
        ))}
        {tags.length > 3 && (
          <span class="text-xs px-2.5 py-1 text-gray-500">
            +{tags.length - 3} more
          </span>
        )}
      </div>
    )}

    <!-- Read More Link -->
    <a
      href={`/blog/${slug}`}
      class="inline-flex items-center text-blue-600 hover:text-blue-700 font-semibold text-sm group/link transition-colors duration-200"
    >
      <span>Read article</span>
      <svg
        class="w-4 h-4 ml-1 group-hover/link:translate-x-1 transition-transform duration-200"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M17 8l4 4m0 0l-4 4m4-4H3"
        />
      </svg>
    </a>
  </div>

  <!-- Subtle gradient overlay on hover -->
  <div class="absolute inset-0 bg-gradient-to-t from-black/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"></div>
</article>

<style>
  /* Add line-clamp utilities if not available */
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>